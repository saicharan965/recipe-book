<ng-container *ngIf="!isLoading;else spinner">
  <div class="container input-group my-3">
    <input type="text" class="form-control form-control-lg" placeholder="Search Recipes" [(ngModel)]="searchTerm"
      (ngModelChange)="searchRecipes()">
    <span class="input-group-text bg-info" id="search-recipes">
      <i class="bi bi-search"></i>
    </span>
    <button class="input-group-text bg-danger" id="clear-search" (click)="resetFilters()">
      <i class="bi bi-x"></i>
    </button>
  </div>


  <div class="row">
    <div class="col-lg-4 col-md-6 col-sm-12" *ngFor="let recipe of filteredRecipes">
      <div class="card mb-4 shadow">
        <div class="card-body">
          <div class="d-flex align-items-center">
            <div class="rounded overflow-hidden profile-picture">
              <img [src]="'assets/images/' + recipe.thumbnailImage" alt="{{ recipe.title }}" class="img-fluid"
                style="width: 150px; height: 100px;" />
            </div>
            <h5 class="ms-3" [innerHtml]="recipe.title | highlight: searchTerm">{{ recipe.title }}</h5>
          </div>
          <p class="card-text">{{ recipe.instructions }}</p>
          <ul class="list-group list-group-flush">
            <li class="list-group-item"><strong>Preparation Time:</strong> {{ recipe.preparationTime }}</li>
            <li class="list-group-item"><strong>Cooking Time:</strong> {{ recipe.cookingTime }}</li>
            <li class="list-group-item"><strong>Servings:</strong> {{ recipe.servings }}</li>
            <li class="list-group-item"><strong>Calories:</strong> {{ recipe.calories }}</li>
            <li class="list-group-item"><strong>Fat:</strong> {{ recipe.fat }}</li>
            <li class="list-group-item"><strong>Protein:</strong> {{ recipe.protein }}</li>
            <li class="list-group-item"><strong>Carbohydrates:</strong> {{ recipe.carbohydrates }}</li>
            <li class="list-group-item"><strong>Cuisine:</strong> {{ recipe.cuisine }}</li>
            <li class="list-group-item"><strong>Category:</strong> {{ recipe.category }}</li>
            <li class="list-group-item"><strong>Difficulty:</strong> {{ recipe.difficulty }}</li>
            <li class="list-group-item"><strong>Tags:</strong> {{ recipe.tags.join(', ') }}</li>
            <li class="list-group-item">
              <strong>Ratings:</strong>
              <span class="star-rating ms-2">
                <span *ngFor="let star of stars" class="bi px-1"
                  [ngClass]="{'bi-star-fill': star <= calculateAverageRating(recipe.ratings), 'bi-star': star > calculateAverageRating(recipe.ratings)}"></span>
              </span>
            </li>
          </ul>
          <span class="d-flex justify-content-center">
            <a [routerLink]="['/recipe', recipe.id]" class="btn btn-primary">View More</a>
          </span>
        </div>
      </div>
    </div>
  </div>

</ng-container>

<ng-template #spinner>
  <recipe-ui-spinner></recipe-ui-spinner>
</ng-template>